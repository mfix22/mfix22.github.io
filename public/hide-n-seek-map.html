<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SF BART + Muni Metro — 1‑Mile Radius Map (N & L Added)</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; width: 100%; }
    .legend {
      position: absolute; z-index: 500; bottom: 14px; left: 14px;
      background: rgba(255,255,255,.95); backdrop-filter: blur(4px);
      border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,.12);
      padding: 10px 12px; font: 13px/1.25 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    .legend h4 { margin: 0 0 6px; font-size: 14px; }
    .legend .swatch { display:inline-block; width:12px; height:12px; border-radius:50%; margin-right:8px; vertical-align: -2px; }
    .leaflet-popup-content { font: 14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="legend">
    <h4>Layers</h4>
    <div><span class="swatch" style="background:#0a84ff"></span>BART stations</div>
    <div><span class="swatch" style="background:#34c759"></span>Muni Metro (subway)</div>
    <div><span class="swatch" style="background:#ff9f0a"></span>N Judah (surface)</div>
    <div><span class="swatch" style="background:#ff375f"></span>L Taraval (surface)</div>
    <div style="margin-top:6px;opacity:.7">Each circle = 1 mile radius</div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script>
    // --- Base map ---
    const map = L.map('map', { zoomControl: true, preferCanvas: true }).setView([37.765, -122.445], 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19, attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    const MILE_METERS = 1609.344;

    function addStops(stops, color) {
      const layer = L.layerGroup();
      stops.forEach(s => {
        const ll = [s.lat, s.lng];
        L.circle(ll, { radius: MILE_METERS, color, weight: 1.2, fillColor: color, fillOpacity: 0.07 }).addTo(layer);
        L.circleMarker(ll, { radius: 4.5, color: '#111', weight: 1, fillColor: color, fillOpacity: 1 })
          .bindPopup(`<strong>${s.name}</strong><br>${s.system}`)
          .addTo(layer);
      });
      return layer;
    }

    // --- BART stations (within San Francisco) ---
    const bartStops = [
      { name: 'Embarcadero (BART/Muni)', lat: 37.792762, lng: -122.397037, system: 'BART + Muni Metro' },
      { name: 'Montgomery St (BART/Muni)', lat: 37.789173, lng: -122.401587, system: 'BART + Muni Metro' },
      { name: 'Powell St (BART/Muni)', lat: 37.784606, lng: -122.407331, system: 'BART + Muni Metro' },
      { name: 'Civic Center / UN Plaza (BART/Muni)', lat: 37.779408, lng: -122.413826, system: 'BART + Muni Metro' },
      { name: '16th St Mission (BART)', lat: 37.765173, lng: -122.419704, system: 'BART' },
      { name: '24th St Mission (BART)', lat: 37.752419, lng: -122.418468, system: 'BART' },
      { name: 'Glen Park (BART)', lat: 37.733235, lng: -122.433515, system: 'BART' },
      { name: 'Balboa Park (BART/Muni)', lat: 37.721747, lng: -122.447457, system: 'BART + Muni' }
    ];

    // --- Muni Metro subway (non-surface) key stations (Market St Subway + Twin Peaks) ---
    const muniSubwayStops = [
      { name: 'Van Ness (Muni Metro)', lat: 37.775152, lng: -122.419267, system: 'Muni Metro' },
      { name: 'Church (Muni Metro)', lat: 37.767435, lng: -122.429043, system: 'Muni Metro' },
      { name: 'Castro (Muni Metro)', lat: 37.762520, lng: -122.435530, system: 'Muni Metro' },
      { name: 'Forest Hill (Muni Metro)', lat: 37.747834, lng: -122.459137, system: 'Muni Metro' },
      { name: 'West Portal (Muni Metro)', lat: 37.741171, lng: -122.465609, system: 'Muni Metro' }
    ];

    // --- N Judah line (surface) — representative stop list from Ocean Beach to Duboce/Cole ---
    const nStops = [
      { name: 'Judah & La Playa', lat: 37.760363, lng: -122.509011, system: 'Muni Metro — N Judah' },
      { name: 'Judah & 46th Ave', lat: 37.760350, lng: -122.505843, system: 'Muni Metro — N Judah' },
      { name: 'Judah & 43rd Ave', lat: 37.760564, lng: -122.502719, system: 'Muni Metro — N Judah' },
      { name: 'Judah & 40th Ave', lat: 37.760711, lng: -122.499257, system: 'Muni Metro — N Judah' },
      { name: 'Judah & Sunset Blvd', lat: 37.760870, lng: -122.495765, system: 'Muni Metro — N Judah' },
      { name: 'Judah & 34th Ave', lat: 37.760992, lng: -122.493065, system: 'Muni Metro — N Judah' },
      { name: 'Judah & 31st Ave', lat: 37.761139, lng: -122.489610, system: 'Muni Metro — N Judah' },
      { name: 'Judah & 28th Ave', lat: 37.761277, lng: -122.486626, system: 'Muni Metro — N Judah' },
      { name: 'Judah & 25th Ave', lat: 37.761418, lng: -122.483409, system: 'Muni Metro — N Judah' },
      { name: 'Judah & 23rd Ave', lat: 37.761547, lng: -122.481164, system: 'Muni Metro — N Judah' },
      { name: 'Judah & 22nd Ave', lat: 37.761534, lng: -122.479855, system: 'Muni Metro — N Judah' },
      { name: 'Judah & 19th Ave', lat: 37.761698, lng: -122.477010, system: 'Muni Metro — N Judah' },
      { name: 'Judah & 12th Ave', lat: 37.762029, lng: -122.469425, system: 'Muni Metro — N Judah' },
      { name: 'Judah & 9th Ave',  lat: 37.762162, lng: -122.466662, system: 'Muni Metro — N Judah' },
      { name: 'Irving & 8th Ave', lat: 37.764038, lng: -122.465428, system: 'Muni Metro — N Judah' },
      { name: 'Irving & 5th Ave', lat: 37.764182, lng: -122.462139, system: 'Muni Metro — N Judah' },
      { name: 'Irving & 2nd Ave', lat: 37.764441, lng: -122.458643, system: 'Muni Metro — N Judah' },
      { name: 'Carl & Hillway',  lat: 37.764910, lng: -122.456770, system: 'Muni Metro — N Judah' },
      { name: 'Carl & Stanyan',  lat: 37.765448, lng: -122.452738, system: 'Muni Metro — N Judah' },
      { name: 'Carl & Cole',     lat: 37.765788, lng: -122.449952, system: 'Muni Metro — N Judah' }
      // (N continues via Sunset Tunnel to the Market St Subway shared stations already shown)
    ];

    // --- L Taraval line (surface) — West Portal to Ocean Beach ---
    const lStops = [
      { name: 'West Portal Station', lat: 37.741171, lng: -122.465609, system: 'Muni Metro — L Taraval' },
      { name: 'Taraval & 15th Ave', lat: 37.743096, lng: -122.471362, system: 'Muni Metro — L Taraval' },
      { name: 'Taraval & 17th Ave', lat: 37.743136, lng: -122.473567, system: 'Muni Metro — L Taraval' },
      { name: 'Taraval & 19th Ave', lat: 37.743037, lng: -122.475652, system: 'Muni Metro — L Taraval' },
      { name: 'Taraval & 22nd Ave', lat: 37.742929, lng: -122.478609, system: 'Muni Metro — L Taraval' },
      { name: 'Taraval & 23rd Ave', lat: 37.742872, lng: -122.480450, system: 'Muni Metro — L Taraval' },
      { name: 'Taraval & 26th Ave', lat: 37.742717, lng: -122.483196, system: 'Muni Metro — L Taraval' },
      { name: 'Taraval & 30th Ave', lat: 37.742534, lng: -122.487423, system: 'Muni Metro — L Taraval' },
      { name: 'Taraval & 32nd Ave', lat: 37.742423, lng: -122.489619, system: 'Muni Metro — L Taraval' },
      { name: 'Taraval & Sunset Blvd', lat: 37.742228, lng: -122.494499, system: 'Muni Metro — L Taraval' },
      { name: 'Taraval & 40th Ave', lat: 37.742049, lng: -122.498186, system: 'Muni Metro — L Taraval' },
      { name: 'Taraval & 42nd Ave', lat: 37.741928, lng: -122.500372, system: 'Muni Metro — L Taraval' },
      { name: 'Taraval & 44th Ave', lat: 37.741864, lng: -122.502481, system: 'Muni Metro — L Taraval' },
      { name: 'Taraval & 46th Ave', lat: 37.741823, lng: -122.504490, system: 'Muni Metro — L Taraval' }
    ];

    // --- Build layers ---
    const bartLayer = addStops(bartStops, '#0a84ff');
    const muniSubwayLayer = addStops(muniSubwayStops, '#34c759');
    const nLayer = addStops(nStops, '#ff9f0a');
    const lLayer = addStops(lStops, '#ff375f');

    // Add default visible layers
    bartLayer.addTo(map);
    muniSubwayLayer.addTo(map);
    nLayer.addTo(map);
    lLayer.addTo(map);

    // Layer control
    const overlays = {
      'BART stations': bartLayer,
      'Muni Metro (subway)': muniSubwayLayer,
      'N Judah (surface)': nLayer,
      'L Taraval (surface)': lLayer
    };
    L.control.layers(null, overlays, { collapsed: false, position: 'topright' }).addTo(map);

    // Fit map to all visible markers
    const all = [].concat(bartStops, muniSubwayStops, nStops, lStops);
    const bounds = L.latLngBounds(all.map(s => [s.lat, s.lng]));
    map.fitBounds(bounds.pad(0.08));
  </script>
</body>
</html>
